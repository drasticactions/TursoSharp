<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:TursoSharpExample.ViewModels"
             mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
             x:Class="TursoSharpExample.Views.MainView"
             x:DataType="vm:MainViewModel">
  <Design.DataContext>
    <vm:MainViewModel />
  </Design.DataContext>

  <TabControl>
    <TabItem Header="App">
      <Grid Background="{DynamicResource SystemRegionBrush}">
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="*"/>
          <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <Border Grid.Row="0" 
                Background="{DynamicResource SystemControlBackgroundAltHighBrush}" 
                BoxShadow="0 2 4 0 #10000000"
                Padding="20">
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <StackPanel Grid.Column="0">
              <TextBlock Text="My Tasks" FontSize="28" FontWeight="Bold"/>
              <TextBlock FontSize="14" Opacity="0.8">
                <Run Text="{Binding TaskCount}"/>
                <Run Text=" tasks, "/>
                <Run Text="{Binding CompletedTaskCount}"/>
                <Run Text=" completed"/>
              </TextBlock>
            </StackPanel>
            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="15" VerticalAlignment="Center">
              <TextBlock Text="{Binding StatusMessage}" 
                         FontSize="12" 
                         Opacity="0.6"
                         VerticalAlignment="Center"/>
              <ProgressBar IsIndeterminate="True" 
                           Width="20" Height="20"
                           IsVisible="{Binding IsBusy}"/>
            </StackPanel>
          </Grid>
        </Border>
        <ScrollViewer Grid.Row="1" Padding="20">
          <ItemsControl ItemsSource="{Binding Tasks}">
            <ItemsControl.ItemsPanel>
              <ItemsPanelTemplate>
                <StackPanel Spacing="8"/>
              </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}" 
                        CornerRadius="8"
                        BoxShadow="0 1 3 0 #10000000"
                        Padding="16"
                        Classes.completed="{Binding IsCompleted}">
                  <Border.Styles>
                    <Style Selector="Border.completed">
                      <Setter Property="Opacity" Value="0.7"/>
                    </Style>
                    <Style Selector="Border.completed TextBlock">
                      <Setter Property="TextDecorations" Value="Strikethrough"/>
                      <Setter Property="Opacity" Value="0.6"/>
                    </Style>
                  </Border.Styles>
                  <Grid>
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="Auto"/>
                      <ColumnDefinition Width="*"/>
                      <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <CheckBox Grid.Column="0" 
                              IsChecked="{Binding IsCompleted, Mode=OneWay}"
                              Command="{Binding $parent[UserControl].((vm:MainViewModel)DataContext).ToggleTaskCompletionCommand}"
                              CommandParameter="{Binding}"
                              VerticalAlignment="Top"
                              Margin="0,2,12,0">
                      <CheckBox.Styles>
                        <Style Selector="CheckBox">
                          <Setter Property="MinWidth" Value="24"/>
                          <Setter Property="MinHeight" Value="24"/>
                        </Style>
                      </CheckBox.Styles>
                    </CheckBox>
                    <StackPanel Grid.Column="1" Spacing="4">
                      <TextBlock Text="{Binding Title}" 
                                 FontSize="16" 
                                 FontWeight="SemiBold"
                                 TextWrapping="Wrap"/>
                      <TextBlock Text="{Binding Description}" 
                                 FontSize="14" 
                                 Opacity="0.8"
                                 TextWrapping="Wrap"
                                 IsVisible="{Binding Description, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                      <TextBlock Text="{Binding CreatedAt, StringFormat='Created {0:MMM d, yyyy}'}" 
                                 FontSize="12" 
                                 Opacity="0.6"/>
                    </StackPanel>
                    <Button Grid.Column="2" 
                            Command="{Binding $parent[UserControl].((vm:MainViewModel)DataContext).DeleteTaskCommand}"
                            CommandParameter="{Binding}"
                            Background="Transparent"
                            BorderThickness="0"
                            Padding="8"
                            VerticalAlignment="Top">
                      <Button.Styles>
                        <Style Selector="Button:pointerover /template/ ContentPresenter">
                          <Setter Property="Background" Value="#10FF0000"/>
                        </Style>
                      </Button.Styles>
                      <Path Data="M 0,0 L 10,10 M 10,0 L 0,10" 
                            Stroke="{DynamicResource SystemControlForegroundBaseHighBrush}" 
                            StrokeThickness="2"
                            Opacity="0.6"/>
                    </Button>
                  </Grid>
                </Border>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
        </ScrollViewer>
        <Border Grid.Row="2" 
                Background="{DynamicResource SystemControlBackgroundAltHighBrush}" 
                BoxShadow="0 -2 4 0 #10000000"
                Padding="20">
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <StackPanel Grid.Column="0" Spacing="8">
              <TextBox Watermark="What needs to be done?" 
                       Text="{Binding NewTaskTitle}"
                       FontSize="16">
                <TextBox.KeyBindings>
                  <KeyBinding Gesture="Enter" Command="{Binding AddTaskCommand}"/>
                </TextBox.KeyBindings>
              </TextBox>
              <TextBox Watermark="Add a description (optional)" 
                       Text="{Binding NewTaskDescription}"
                       FontSize="14"
                       AcceptsReturn="True"
                       TextWrapping="Wrap"
                       MaxHeight="80"/>
            </StackPanel>
            <Button Grid.Column="1" 
                    Content="Add Task"
                    Command="{Binding AddTaskCommand}"
                    IsEnabled="{Binding !IsBusy}"
                    VerticalAlignment="Bottom"
                    Margin="12,0,0,0"
                    Padding="16,8"
                    FontWeight="SemiBold">
              <Button.Styles>
                <Style Selector="Button">
                  <Setter Property="Background" Value="{DynamicResource SystemAccentColor}"/>
                  <Setter Property="Foreground" Value="White"/>
                  <Setter Property="CornerRadius" Value="6"/>
                </Style>
                <Style Selector="Button:pointerover /template/ ContentPresenter">
                  <Setter Property="Background" Value="{DynamicResource SystemAccentColorDark1}"/>
                </Style>
                <Style Selector="Button:disabled /template/ ContentPresenter">
                  <Setter Property="Background" Value="{DynamicResource SystemControlDisabledBaseMediumLowBrush}"/>
                </Style>
              </Button.Styles>
            </Button>
          </Grid>
        </Border>
      </Grid>
    </TabItem>
    <TabItem Header="Advanced">
      <ScrollViewer>
        <StackPanel Margin="20" Spacing="20">
          <StackPanel Spacing="10">
            <TextBlock Text="{Binding Greeting}" 
                       FontSize="24" FontWeight="Bold" 
                       HorizontalAlignment="Center"/>
            <TextBlock Text="{Binding StatusMessage}" 
                       FontSize="14" Foreground="Gray"
                       HorizontalAlignment="Center"/>
          </StackPanel>
          <Border BorderBrush="Gray" BorderThickness="1" CornerRadius="5" Padding="15">
            <StackPanel Spacing="10">
              <TextBlock Text="Database Connection" FontSize="18" FontWeight="SemiBold"/>
              
              <StackPanel Orientation="Horizontal" Spacing="10">
                <Button Content="Memory Database" 
                        Command="{Binding InitializeMemoryDatabaseCommand}"
                        IsEnabled="{Binding !IsBusy}"/>
                <Button Content="File Database" 
                        Command="{Binding InitializeFileDatabaseCommand}"
                        IsEnabled="{Binding !IsBusy}"/>
              </StackPanel>
              
              <StackPanel Orientation="Horizontal" Spacing="20">
                <TextBlock>
                  <Run Text="Status: "/>
                  <Run Text="{Binding ConnectionType}" FontWeight="SemiBold"/>
                </TextBlock>
                <TextBlock>
                  <Run Text="Connected: "/>
                  <Run Text="{Binding IsConnected}" FontWeight="SemiBold"/>
                </TextBlock>
              </StackPanel>
            </StackPanel>
          </Border>
          <Border BorderBrush="Gray" BorderThickness="1" CornerRadius="5" Padding="15"
                  IsVisible="{Binding IsConnected}">
            <StackPanel Spacing="10">
              <StackPanel Orientation="Horizontal" Spacing="10">
                <TextBlock Text="Database Statistics" FontSize="18" FontWeight="SemiBold"/>
                <Button Content="Refresh" 
                        Command="{Binding RefreshStatsCommand}"
                        IsEnabled="{Binding !IsBusy}"/>
              </StackPanel>
              
              <Grid ColumnDefinitions="*,*" Margin="0,10">
                <StackPanel Grid.Column="0">
                  <TextBlock Text="Total Tasks" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                  <TextBlock Text="{Binding TaskCount}" FontSize="24" HorizontalAlignment="Center"/>
                </StackPanel>
                <StackPanel Grid.Column="1">
                  <TextBlock Text="Completed Tasks" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                  <TextBlock Text="{Binding CompletedTaskCount}" FontSize="24" HorizontalAlignment="Center"/>
                </StackPanel>
              </Grid>
            </StackPanel>
          </Border>
          <Border BorderBrush="Gray" BorderThickness="1" CornerRadius="5" Padding="15" IsVisible="{Binding IsConnected}">
            <StackPanel Spacing="10">
              <StackPanel Orientation="Horizontal" Spacing="10">
                <TextBlock Text="Tasks" FontSize="18" FontWeight="SemiBold"/>
                <Button Content="Refresh" 
                        Command="{Binding RefreshDataCommand}"
                        IsEnabled="{Binding !IsBusy}"/>
              </StackPanel>
              
              <DataGrid ItemsSource="{Binding Tasks}"
                        SelectedItem="{Binding SelectedTask}"
                        Height="300"
                        CanUserReorderColumns="True"
                        CanUserResizeColumns="True"
                        CanUserSortColumns="True"
                        GridLinesVisibility="All"
                        IsReadOnly="False">
                <DataGrid.Columns>
                  <DataGridTextColumn Header="ID" Binding="{Binding Id}" IsReadOnly="True" Width="50"/>
                  <DataGridTextColumn Header="Title" Binding="{Binding Title}" Width="200"/>
                  <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="300"/>
                  <DataGridCheckBoxColumn Header="Completed" Binding="{Binding IsCompleted}" Width="80"/>
                  <DataGridTextColumn Header="Created" Binding="{Binding CreatedAt, StringFormat='{}{0:MM/dd/yyyy}'}" IsReadOnly="True" Width="100"/>
                  <DataGridTemplateColumn Header="Actions" Width="150">
                    <DataGridTemplateColumn.CellTemplate>
                      <DataTemplate>
                        <StackPanel Orientation="Horizontal" Spacing="5">
                          <Button Content="Toggle" 
                                  Command="{Binding $parent[UserControl].((vm:MainViewModel)DataContext).ToggleTaskCompletionCommand}"
                                  CommandParameter="{Binding}"
                                  Background="Blue"
                                  Foreground="White"
                                  FontSize="10"/>
                          <Button Content="Delete" 
                                  Command="{Binding $parent[UserControl].((vm:MainViewModel)DataContext).DeleteTaskCommand}"
                                  CommandParameter="{Binding}"
                                  Background="Red"
                                  Foreground="White"
                                  FontSize="10"/>
                        </StackPanel>
                      </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                  </DataGridTemplateColumn>
                </DataGrid.Columns>
              </DataGrid>
            </StackPanel>
          </Border>
          <Border BorderBrush="Gray" BorderThickness="1" CornerRadius="5" Padding="15" IsVisible="{Binding IsConnected}">
            <StackPanel Spacing="10">
              <TextBlock Text="Add New Task" FontSize="18" FontWeight="SemiBold"/>
              
              <Grid ColumnDefinitions="*,10,2*">
                <TextBox Grid.Column="0" Watermark="Title *" Text="{Binding NewTaskTitle}"/>
                <TextBox Grid.Column="2" Watermark="Description" 
                         Text="{Binding NewTaskDescription}"
                         AcceptsReturn="True" 
                         TextWrapping="Wrap"
                         Height="60"/>
              </Grid>
              
              <Button Content="Add Task" 
                      Command="{Binding AddTaskCommand}"
                      IsEnabled="{Binding !IsBusy}"
                      HorizontalAlignment="Left"
                      Width="150"/>
            </StackPanel>
          </Border>
          <Border BorderBrush="Gray" BorderThickness="1" CornerRadius="5" Padding="15"
                  IsVisible="{Binding IsConnected}">
            <StackPanel Spacing="10">
              <TextBlock Text="Testing &amp; Demos" FontSize="18" FontWeight="SemiBold"/>
              
              <StackPanel Orientation="Horizontal" Spacing="10">
                <Button Content="Performance Test" 
                        Command="{Binding RunPerformanceTestCommand}"
                        IsEnabled="{Binding !IsBusy}"/>
                <Button Content="Error Handling Test" 
                        Command="{Binding TestErrorHandlingCommand}"
                        IsEnabled="{Binding !IsBusy}"/>
                <Button Content="Clear Log" 
                        Command="{Binding ClearLogCommand}"/>
              </StackPanel>
              
              <TextBlock Text="Operation Log:" FontWeight="SemiBold" Margin="0,10,0,5"/>
              <ListBox ItemsSource="{Binding OperationLog}" 
                       Height="200" 
                       Background="Black" 
                       Foreground="LightGreen"
                       FontFamily="Consolas, Monaco, 'Courier New', monospace"
                       FontSize="12">
                <ListBox.Styles>
                  <Style Selector="ListBoxItem">
                    <Setter Property="Padding" Value="5,2"/>
                    <Setter Property="Margin" Value="0"/>
                  </Style>
                </ListBox.Styles>
              </ListBox>
            </StackPanel>
          </Border>
          <StackPanel Orientation="Horizontal" Spacing="10" 
                      IsVisible="{Binding IsBusy}"
                      HorizontalAlignment="Center">
            <ProgressBar IsIndeterminate="True" Width="200" Height="10"/>
            <TextBlock Text="Working..." VerticalAlignment="Center"/>
          </StackPanel>
        </StackPanel>
      </ScrollViewer>
    </TabItem>
  </TabControl>
</UserControl>